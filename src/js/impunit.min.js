/*
 Copyright 2011 Manuel RÃ¼lke, http://homecoded.com
 Licensed under the Apache License, Version 2.0
 Check https://github.com/homecoded/impunit for documentation and complete license
 */

var impunit=function(){function h(){function r(a,e){s=!0;e?(t+="ASYNC TEST ("+e+"):\n"+a+"\n\n",0>m.indexOf(e)&&m.push(e),c&&c()):n+=a+"\n\n";u||alert(a)}function h(a,e,b,d){!1===a&&r("TEST FAILED\nTest Name: "+f+"\n"+e+": "+b,d);d&&c&&(0>l.indexOf(d)&&l.push(d),c())}var b={},n="",t="",s,p=-1,j=-1,m=[],u=!0,f,k,q={},v,l=[],c=null,g={},w=0;b.runTests=function(a){a||r("ERROR: No Test Suite specified.");a instanceof Array||(a=[a]);var e;j=p=0;m=[];l=0;l=[];q={};n="";var b=a.length;for(i=0;i<b;i++){var d=
a[i],g=d._setup?d._setup:function(){},c=d._teardown?d._teardown:function(){};for(e in d)if(d.hasOwnProperty(e)){f=e;try{"function"===typeof d[f]&&0===f.indexOf("_test")&&(w++,s=!1,p+=1,k=d,v=!1,g.call(k),d[f].call(k),v?q[f+w]=c:c.call(k),s&&(j+=1))}catch(h){j+=1,r("TEST FAILED\nTest Name: "+f+"\nError: "+h),c&&c.call(k)}}}};b.assertTrue=function(a,e){h(a,"assertTrue",e,b.assertTrue.caller.testName)};b.assertEqual=function(a,e,c){h(a===e,"assertEqual ("+a+") != ("+e+")",c,b.assertEqual.caller.testName)};
b.messages=function(){return n};b.asyncMessages=function(){return t};b.testsFailed=function(){return j};b.asyncTestsFailed=function(){return m.length};b.testsRun=function(){return p};b.asyncTestsRun=function(){return l.length};b.silent=function(a){0<arguments.length&&(u=a?!0:!1);return u};b.onAsyncTestFailed=function(a){0<arguments.length&&"function"===typeof a&&(c=a);return c};b.asyncCallback=function(a){v=!0;var b=k;a.testName=f;a.id=w;g[f+a.id]||(g[f+a.id]=[]);g[f+a.id].push(a);return function(){var c=
a.testName;if(g[c+a.id]){var d=g[c+a.id].indexOf(a);g[c+a.id].splice(d,1)}a.apply(b,arguments);(!g[c+a.id]||0==g[c+a.id].length)&&q[c+a.id]&&q[c+a.id].call(b)}};return b}var x=h();x.createInstance=h;return x}();
